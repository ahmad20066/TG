{% stylesheet %}
.categories {
  padding: 0.5rem 0;
  width: 100vw;
  margin-left: calc(-50vw + 50%);
  margin-right: calc(-50vw + 50%);
  background-color: #FFFFFF;
  position: relative;
  margin-top: -1px;
}

.categories__container {
  width: 100%;
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 2rem;
}

.categories__heading {
  font-family: "Frutiger Serif Light", serif;
  font-size: clamp(2.5rem, 5vw, 3.5rem);
  color: #2E2E2E;
  text-align: center;
  margin-bottom: 3rem;
  font-weight: 300;
  letter-spacing: -0.02em;
  position: relative;
  opacity: 0;
  transform: translateY(30px);
  transition: all 0.8s ease-out;
}

.categories__heading.animate {
  opacity: 1;
  transform: translateY(0);
}

.categories__heading::after {
  content: '';
  position: absolute;
  bottom: -0.5rem;
  left: 50%;
  transform: translateX(-50%);
  width: 80px;
  height: 3px;
  background-color: #DAE3EA;
  transform: translateX(-50%) scaleX(0);
  transform-origin: center;
  animation: scaleIn 0.6s ease-out 0.8s forwards;
}

.categories__grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1.5rem;
  max-width: 1400px;
  margin: 0 auto;
}

.category-card {
  position: relative;
  background-color: #FFFFFF;
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.6s ease;
  opacity: 0;
  transform: translateY(30px);
  border: 2px solid #DAE3EA;
}

.category-card.animate {
  animation: fadeInUp 0.8s ease-out forwards;
}

.category-card:nth-child(1).animate { animation-delay: 0.1s; }
.category-card:nth-child(2).animate { animation-delay: 0.2s; }
.category-card:nth-child(3).animate { animation-delay: 0.3s; }
.category-card:nth-child(4).animate { animation-delay: 0.4s; }
.category-card:nth-child(5).animate { animation-delay: 0.5s; }
.category-card:nth-child(6).animate { animation-delay: 0.6s; }
.category-card:nth-child(7).animate { animation-delay: 0.7s; }
.category-card:nth-child(8).animate { animation-delay: 0.8s; }
.category-card:nth-child(9).animate { animation-delay: 0.9s; }

.category-card:hover {
  transform: translateY(-8px);
}

.category-card__image {
  width: 100%;
  height: 300px;
  position: relative;
  overflow: hidden;
  background-color: #f8f9fa;
  border-radius: 10px;
  padding: 8px;
  box-sizing: border-box;
}

.category-card__image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.6s ease;
  border-radius: 8px;
}

.category-card:hover .category-card__image img {
  transform: scale(1.05);
}

.category-card__title {
  font-family: "Frutiger Serif Light", serif;
  font-size: 1.25rem;
  font-weight: 400;
  color: #2E2E2E;
  text-align: center;
  padding: 1.25rem;
  margin: 0;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  background-color: #FFFFFF;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes scaleIn {
  from {
    transform: translateX(-50%) scaleX(0);
  }
  to {
    transform: translateX(-50%) scaleX(1);
  }
}

@media screen and (max-width: 1024px) {
  .categories__grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }
  
  .category-card__image {
    height: 280px;
  }
  
  .category-card__title {
    padding: 1.25rem;
    font-size: 1.2rem;
  }
}

@media screen and (max-width: 768px) {
  .categories {
    padding: 0.5rem 0 1.5rem 0;
  }

  .categories__container {
    padding: 0 1rem;
  }

  .categories__heading {
    margin-bottom: 1.5rem;
  }

  .categories__grid {
    display: flex;
    overflow-x: auto;
    gap: 1.5rem;
    max-width: 100%;
    padding: 1rem 0;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .categories__grid::-webkit-scrollbar {
    display: none;
  }

  .category-card {
    flex: 0 0 280px;
    max-width: 280px;
    scroll-snap-align: start;
    margin: 0;
  }

  .category-card__image {
    height: 250px;
  }
  
  .category-card__title {
    padding: 1.25rem;
    font-size: 1.25rem;
  }
}

@media screen and (max-width: 480px) {
  .categories__grid {
    gap: 1rem;
  }
  
  .category-card {
    flex: 0 0 250px;
    max-width: 250px;
  }
  
  .category-card__image {
    height: 220px;
  }
  
  .category-card__title {
    padding: 1rem;
    font-size: 1.1rem;
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes scaleIn {
  from {
    transform: translateX(-50%) scaleX(0);
  }
  to {
    transform: translateX(-50%) scaleX(1);
  }
}
{% endstylesheet %}

<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('Categories script loaded');
  
  const observerOptions = {
    threshold: 0.2,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver(function(entries) {
    entries.forEach(entry => {
      console.log('Intersection observed:', entry.isIntersecting);
      if (entry.isIntersecting) {
        console.log('Adding animate class to categories');
        entry.target.classList.add('animate');
        
        // Also add animate class to heading and individual cards
        const heading = entry.target.querySelector('.categories__heading');
        const cards = entry.target.querySelectorAll('.category-card');
        
        if (heading) heading.classList.add('animate');
        
        cards.forEach((card, index) => {
          console.log('Animating card', index + 1);
          card.classList.add('animate');
        });
        
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  // Observe the categories container
  const categoriesContainer = document.querySelector('.categories');
  if (categoriesContainer) {
    console.log('Categories container found, observing...');
    observer.observe(categoriesContainer);
  } else {
    console.log('Categories container NOT found!');
  }
});
</script>

<div class="categories">
  <div class="categories__container">
    <h2 class="categories__heading">{{ section.settings.heading }}</h2>
    
    <div class="categories__grid">
      {% for collection in collections limit: 9 %}
        {% unless collection.handle == 'frontpage' or collection.handle == section.settings.exclude_collection.handle %}
          <div class="category-card">
            <div class="category-card__image">
              {% if collection.image != blank %}
                <img src="{{ collection.image | image_url: width: 800 }}" 
                     alt="{{ collection.title }}"
                     loading="lazy"
                     width="{{ collection.image.width }}"
                     height="{{ collection.image.height }}">
              {% else %}
                <div style="width: 100%; height: 100%; background-color: #f8f9fa; display: flex; align-items: center; justify-content: center; color: #2E2E2E; font-family: 'Newsreader', serif; font-style: italic; text-align: center; padding: 1rem;">
                  {{ collection.title }}
                </div>
              {% endif %}
            </div>
            <h3 class="category-card__title">{{ collection.title }}</h3>
            <a href="{{ collection.url }}" class="category-card__link" aria-label="View {{ collection.title }} Collection"></a>
          </div>
        {% endunless %}
      {% endfor %}
    </div>
  </div>
</div>

<!-- Section Divider -->
{% render 'section-divider', style: 'line' %}

{% schema %}
{
  "name": "Categories",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Discover Our Collections"
    },
    {
      "type": "collection",
      "id": "exclude_collection",
      "label": "Collection to Exclude",
      "info": "This collection will not appear in the categories section (useful for featured collections)"
    }
  ],
  "presets": [
    {
      "name": "Categories",
      "category": "Image"
    }
  ]
}
{% endschema %}
